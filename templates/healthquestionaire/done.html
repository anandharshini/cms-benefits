{% extends "fullwidth.html" %}
{% load cms_tags %}
{% load i18n %}

{% block content %}

<div class="container">
<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<h4>AGREEMENTS, AUTHORIZATION & ATTESTATION</h4>
<p>Please review your completed application below.  Once all provided information is complete and accurate, please read section 7 at the end of the PDF and sign using the signature card below.
    </p>
<div class="row">
    <div class="col s12">
        {% if signed_pdf_file != '' %}
            <input type="hidden" id="hidden-pdf-file-url" value="{{ signed_pdf_file }}">
            <a href="{{ signed_pdf_file }}" target="_blank">Open Completed PDF Application</a>
            <div>
                <object data="{{ signed_pdf_file }}" type="application/pdf" width="100%" height="700px">
                alt : <a href="{{ signed_pdf_file }}">Open Completed PDF Application</a>
                </object>
            </div>
            
        {% else %}
            <div><h3>NO SIGNED PDF FILE</h3></div>
        {% endif %}
    </div>
    <div class="col s12">
        {% if not check_signed_file %}
        <form id="signForm" method="POST" action="">
            {% csrf_token %}
            <div class="card grey darken-1" style="padding-bottom:0px;" width="100%">
                <!-- {{ form.as_p }} -->
                {% if error_status %}
                <div class="card-panel red lighten-2">{{ error_status }}</div>
                {% endif %}
                <input type="hidden" name="sign_data" maxlength="1024" required id="id_sign_data" />
                <div class="card-content white-text" style="padding-bottom:0px;" width="100%">
                    <span class="card-title">Signature Card</span>
                                <canvas id="cvs-sign-pad" width="800"></canvas>

                </div> 
               
                <div class="card-action">
                    <button onclick="clearSignature()" class="btn"  style="background-color:#992A43;">Clear</button>
                    <button onclick="submitSignature()" class="btn"  style="background-color:#992A43;">Submit</button>
                </div>
            </div>                
        </form>
        {% endif %}
    </div>
</div>
<br><br>
<div class="row">
        {% if not check_signed_file %}
            <div class="col s11">
                <a class="waves-effect waves-light btn" href="{{PREFIX_URL}}medicals/?employee={{ request.GET.employee }}">Back</a>
            </div>
        {% endif %}
        <div class="col s1">
            <a class="waves-effect waves-light btn" href="{{PREFIX_URL}}?toolbar_off">Finish</a>
        </div>
    </div>
</div>
<script>
    var canvas = document.querySelector("#cvs-sign-pad");
    var signature = null;
    if (canvas){
        signaturePad = new SignaturePad(canvas);
    }
    
    function clearSignature(ev) {
        signaturePad.clear();
    }

    function submitSignature(ev) {
        const data = signaturePad.toDataURL();
        document.getElementsByName('sign_data')[0].value = data;
        //document.getElementById('signForm').submit();
    }
    
</script>
{% endblock %}